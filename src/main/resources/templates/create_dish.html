<!DOCTYPE>
<html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta charset="utf-8"/>
    <title>秀厨-唯爱与美食不可辜负</title>
    <script src="../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="../css/main.css"/>
    <link rel="stylesheet" type="text/css" href="../css/c_dish.css"/>

</head>
<body style="padding-top: 0px;">
<div class="header"><!--------------头部---------------->
    <div class="conwidth">
        <h1 class="fl" style=" margin-top: -2px;"><a href="" class="bigtitle">秀<span>厨</span></a></h1>
        <div class="search fl" id="search-box">
            <form action="#" method="get" target="_blank">
                <input type="text" placeholder="搜索菜谱、食材"
                       id="sreach-input" class="search-text fl"/>
                <input type="button" value="搜菜谱" class="search-btn fl"/>
            </form>
        </div>
        <div class="nav fr">
            <ul>
                <li><a href="/index">首页</a></li>
                <li class="menu-class"><a href="/menu_class">菜谱分类</a>
                    <div class="topbar-menu">
                        <ul class="plain">
                            <li class='topbar-menu-head'>常用主题</li>
                            <li><a href="/menu_class">家常菜</a></li>
                            <li><a href="/menu_class">快手菜</a></li>
                            <li><a href="/menu_class">下饭菜</a></li>
                            <li><a href="/menu_class">早餐</a></li>
                            <li><a href="/menu_class">减肥</a></li>
                            <li><a href="/menu_class">汤羹</a></li>
                            <li><a href="/menu_class">烘焙</a></li>
                            <li><a href="/menu_class">小吃</a></li>
                        </ul>
                        <ul class="plain">
                            <li class='topbar-menu-head'>常见食材</li>
                            <li><a href="/menu_class">猪肉</a></li>
                            <li><a href="/menu_class">鸡肉</a></li>
                            <li><a href="/menu_class">牛肉</a></li>
                            <li><a href="/menu_class">鱼</a></li>
                            <li><a href="/menu_class">鸡蛋</a></li>
                            <li><a href="/menu_class">土豆</a></li>
                            <li><a href="/menu_class">茄子</a></li>
                            <li><a href="/menu_class">豆腐</a></li>
                        </ul>
                        <ul class="plain">
                            <li class='topbar-menu-head'>时令食材</li>
                            <li><a href="/menu_class">春笋</a></li>
                            <li><a href="/menu_class">笋</a></li>
                            <li><a href="/menu_class">豌豆</a></li>
                            <li><a href="/menu_class">草莓</a></li>
                            <li><a href="/menu_class">金桔</a></li>
                            <li><a href="/menu_class">菠菜</a></li>
                            <li><a href="/menu_class">冬笋</a></li>
                            <li><a href="/menu_class">韭菜</a></li>
                        </ul>
                        <div class="span">
                            <span><a href="/menu_class">查看全部分类</a></span>
                        </div>
                    </div>
                </li>
                <li><a href="/popular_menu">菜单</a></li>
                <li><a href="/activity">作品动态</a></li>
            </ul>

            <!---------------------施工现场---------------------->
            <div id="login_change">
                <div class="dengluzhuce fr">
                    <a href="/login">登录</a>
                    <a href="/register">注册</a>
                </div>

            </div>


        </div>
    </div>
    <div class="suggest" id="sreach-suggest"><!---搜索智能提示suggest-->
        <ul>
            <li>搜" "相关用户</li>
            <li>搜" "相关菜单</li>
        </ul>
    </div>
</div>
<div class="konghang"></div><!--因为头部固定而需要设置高度空行把内容撑下去-->


<div class="page-outer">
    <!--begin of page-container-->
    <div class="page-container">
        <div class="pure-g">
            <!-- begin of main-panel -->
            <form enctype="multipart/form-data" method="POST" action="/work/upphoto">
                <div class="pure-u-2-3 main-panel">


                    <h1 class="page-title">
                        上传我做的<span th:text="${recipeName}"></span>
                    </h1>

                    <div class="block block-has-padding white-bg">
                        </div>
                            <div class="control-group">
                                <label for="img" class="label">在电脑里面查找</label>
                                <div class="control">
                                    <input type="file" name="img" id="img">
                                    <p class="gray-font normal-font">请选择不超过4M的图片</p>
                                </div>
                            </div>
                            <div class="control-group"></div>
                            <div class="control-group">
                                <label for="desc" class="label">
                                    心得
                                </label>
                                <div class="control">
                                    <textarea name="desc" id="desc" rows="15" maxlength="200"></textarea>
                                </div>
                            </div>

                            <div class="control-group">&nbsp;</div>

                            <div class="control-group">
                                <div class="label">&nbsp;</div>
                                <div class="control">
                                    <input  type="button" value="上传作品" class="button" id="sssubmit">
                                </div>
                            </div>
                    <span hidden id="hid"></span>
                    <span hidden id="hhid" th:text="${recipeId}"></span>
                    </div>
            </form>
            <div id="main-panel-bottom"></div>
            </div>
        </div>
    </div>
</div>
<script>
    //上传作品
$("#img").click(function () {
    var picture=new FormData();
    picture.append("file",this.files[0]);
    $.ajax({
        type:'POST',
        url:"/work/upphoto",
        data:picture,
        contentType:false,
        processData:false,//这个很有必要，不然不行
        dataType:"json",
        success:function(result){
            if(result.success) {
                var thisUrl = result.data.imgUrl ;//获取文件信息
                $("#hid").text(result.data);
            }
        },
        error:function(){
            console.log("无事发生");
        }

    });
});
$("#sssubmit").click(function () {
    var imgURL=$("#hid").text();
    //菜谱id 菜谱图片url
    var formVO= {};
    formVO.imgUrl = imgURL;
    formVO.recipeId = $("#hhid").text();
    formVO.workInfo = $("#desc").val();
    console.log(formVO);
    $.ajax({
        type : 'POST',
        dataType:"json",
        contentType: 'application/json',
        url : "/work/up",
        data:JSON.stringify(formVO),
        success : function(data) {
            console.log("上传成功");
        }});

});
</script>
</body>
</html>